# Copies build artifacts from bin folders and publishes them

steps:

  - task: CopyFiles@2
    displayName: 'Copy build artifacts'
    condition: always()
    inputs:
      SourceFolder: $(build.sourcesdirectory)
      Contents: |
        **/Uno.Sdk/bin/**/*.nupkg
        **/bin/**/*.dll
        **/bin/**/*.pdb
        **/bin/**/*.xml
        **/bin/**/*.xbf
        **/bin/**/*.xaml
        **/bin/**/*.pri
        **/bin/**/*.aar
        **/bin/**/*.json
        **/bin/**/*.config
      TargetFolder: $(build.sourcesdirectory)/build-artifacts/bin-$(XAML_FLAVOR_BUILD)
      CleanTargetFolder: false
      OverWrite: false
      flattenFolders: false

  - task: ArchiveFiles@2
    displayName: 'Archive build artifacts'
    inputs:
      rootFolderOrFile: $(build.sourcesdirectory)/build-artifacts/bin-$(XAML_FLAVOR_BUILD)
      includeRootFolder: false
      archiveType: 'zip'
      archiveFile: '$(Build.ArtifactStagingDirectory)/$(ArchiveName)-$(XAML_FLAVOR_BUILD).zip'

  - task: PublishBuildArtifacts@1
    displayName: 'Publish build artifacts'
    condition: always()
    retryCountOnTaskFailure: 3
    inputs:
      PathtoPublish: $(build.artifactstagingdirectory)
      ArtifactName: '$(ArtifactName)-$(XAML_FLAVOR_BUILD)'
      ArtifactType: Container